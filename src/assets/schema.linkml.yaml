# yaml-language-server: $schema=https://linkml.io/linkml-model/linkml_model/jsonschema/meta.schema.json

id: http://behaverse.org/schemas/studyflow
name: studyflow
title: Behaverse Studyflow Schema
description: LinkML schema for Behaverse Studyflow BPMN extension
version: 25.1217.dev2
license: MIT

prefixes:
  studyflow: http://behaverse.org/schemas/studyflow/
  bpmn: http://www.omg.org/spec/BPMN/20100524/MODEL#
  linkml: https://w3id.org/linkml/

default_prefix: studyflow
default_range: string

imports:
  - linkml:types

enums:
  DatasetFormatEnum:
    description: Format of the dataset (BDM, BIDS, Psych-DS, etc).
    permissible_values:
      bdm:
        title: BDM (Behaverse Data Model)
        description: BDM (Behaverse Data Model)
      bids:
        title: BIDS (Brain Imaging Data Structure)
        description: BIDS (Brain Imaging Data Structure)
        annotations:
          icon: bids-dataset-icon
      psych-ds:
        title: Psych-DS
        description: Psych-DS
      kedro:
        title: Kedro
        description: Kedro
      undefined:
        title: Undefined
        description: Undefined (other formats not listed here)

  BDMDataLevelEnum:
    description: BDM level of the data (events, trials, models).
    permissible_values:
      events:
        title: Events
        description: Events
      trials:
        title: Trials
        description: Trials
      models:
        title: Models
        description: Models

  BIDSDataTypeEnum:
    description: BIDS data type (e.g., anat, func, etc).
    permissible_values:
      anat:
        title: anat (anatomical MRI)
        description: anat (anatomical MRI)
      beh:
        title: beh (behavioral)
        description: beh (behavioral)
      dwi:
        title: dwi (diffusion MRI)
        description: dwi (diffusion MRI)
      eeg:
        title: eeg (electroencephalography)
        description: eeg (electroencephalography)
      func:
        title: func (functional MRI)
        description: func (functional MRI)
      ieeg:
        title: ieeg (intracranial EEG)
        description: ieeg (intracranial EEG)
      meg:
        title: meg (magnetoencephalography)
        description: meg (magnetoencephalography)
      micr:
        title: micr (microscopy)
        description: micr (microscopy)
      motion:
        title: motion (motion capture)
        description: motion (motion capture)
      mrs:
        title: mrs (magnetic resonance spectroscopy)
        description: mrs (magnetic resonance spectroscopy)
      nirs:
        title: nirs (near-infrared spectroscopy)
        description: nirs (near-infrared spectroscopy)
      perf:
        title: perf (arterial spin labeling)
        description: perf (arterial spin labeling)
      pet:
        title: pet (positron emission tomography)
        description: pet (positron emission tomography)

  AssignmentAlgorithmEnum:
    description: The scheduling algorithm used for the assignment.
    permissible_values:
      probabilistic:
        title: Probabilistic
        description: Probabilistic
      round-robin:
        title: Round Robin
        description: Round Robin

  ProbabilityDistributionEnum:
    description: The random statistical distribution used for the assignment.
    permissible_values:
      uniform:
        title: Uniform
        description: Uniform
      normal:
        title: Normal
        description: Normal
      exponential:
        title: Exponential
        description: Exponential
      poisson:
        title: Poisson
        description: Poisson
      undefined:
        title: Undefined
        description: Undefined

  DataOperationEnum:
    description: |
      Studyflow data operator marker for tasks. Operators describe how data is manipulated
      as it flows through the process (pure transformations).
    permissible_values:
      transform:
        title: Transform
        description: Generic pure data transformation.
      map:
        title: Map
        description: Element-wise transformation.
      filter:
        title: Filter
        description: Subset selection based on criteria.
      reduce:
        title: Reduce
        description: Aggregation (N -> 1) per group or overall.
      group:
        title: Group
        description: Grouping operation changing structure into grouped format.
      compose:
        title: Compose
        description: Compose multiple operators into a pipeline.
      flatMap:
        title: FlatMap
        description: Map followed by flattening (1 -> N).

  InstrumentEnum:
    description: The type of instrument used to measure cognitive performance.
    permissible_values:
      behaverse:
        title: Behaverse
        description: Behaverse
        annotations:
          icon: iconify bi--hexagon
      videoGame:
        title: Video Game
        description: Video Game
        annotations:
          icon: iconify bi--controller
      rest:
        title: Rest
        description: Rest
        annotations:
          icon: iconify solar--armchair-2-linear
      undefined:
        title: Undefined
        description: Undefined

  BehaverseTaskEnum:
    permissible_values:
      BCS:
        title: Belval Card Sorting (BCS)
        description: Belval Card Sorting (BCS)
      BM:
        title: Belval Matrices (BM)
        description: Belval Matrices (BM)
      BSAC:
        title: Button Spatial Attention Cueing (BSAC)
        description: Button Spatial Attention Cueing (BSAC)
      DS:
        title: Digit Span (DS)
        description: Digit Span (DS)
      ML:
        title: Monkey Ladder (ML)
        description: Monkey Ladder (ML)
      MOT:
        title: Multiple Object Tracking (MOT)
        description: Multiple Object Tracking (MOT)
      NB:
        title: N-Back (NB)
        description: N-Back (NB)
      OC:
        title: Ordered Click (OC)
        description: Ordered Click (OC)
      OOO:
        title: Odd One Out (OOO)
        description: Odd One Out (OOO)
      PC:
        title: Polygon Comparison (PC)
        description: Polygon Comparison (PC)
      RE:
        title: Regular Expression (RE)
        description: Regular Expression (RE)
      SART:
        title: Sustained Attention to Response Task (SART)
        description: Sustained Attention to Response Task (SART)
      SMC:
        title: Symbolic Matrix Comparison (SMC)
        description: Symbolic Matrix Comparison (SMC)
      SOS:
        title: Self-Ordered Search (SOS)
        description: Self-Ordered Search (SOS)
      SRM:
        title: Stimulus-Response Mapping (SRM)
        description: Stimulus-Response Mapping (SRM)
      SRT:
        title: Serial Reaction Time (SRT)
        description: Serial Reaction Time (SRT)
      SS:
        title: Spatial Span (SS)
        description: Spatial Span (SS)
      TH:
        title: Target Hit (TH)
        description: Target Hit (TH)
      TOVA:
        title: Test of Variable Attention (TOVA)
        description: Test of Variable Attention (TOVA)
      UFOV:
        title: Useful Field of View (UFOV)
        description: Useful Field of View (UFOV)
      WO:
        title: Which One (WO)
        description: Which One (WO)
      undefined:
        title: Undefined
        description: Undefined

types:
  MarkdownString:
    typeof: string
    description: A string that contains markdown formatting

classes:
  BaseElement:
    description: Base class for all elements in the Studyflow.
    abstract: true
    class_uri: bpmn:BaseElement
    attributes:
      id:
        identifier: true
        range: string
        description: Unique identifier for the element.
        categories: 
          - General
      documentation:
        range: MarkdownString
        description: Optional human-readable description for the element (or link to a detailed description).
        categories:
          - Documentation
      checklist:
        range: MarkdownString
        description: List of items to be checked off when completing the element, formatted in markdown.
        categories:
          - Documentation

  Checklist:
    description: A checklist for the element.
    abstract: true
    attributes:
      items:
        multivalued: true
        range: MarkdownString
        description: Checklist items.
        categories:
          - Documentation

  Study:
    description: Process definition for a Studyflow study.
    is_a: bpmn:Process
    annotations:
      icon: iconify bi--journal-text
    attributes: {}

  StartEvent:
    class_uri: bpmn:StartEvent
    annotations:
      icon: iconify bpmn--start-event
    attributes:
      requiresConsent:
        range: boolean
        ifabsent: "false"
        description: User requires to give consent before participating.
        categories:
          - Privacy
      consentFormUrl:
        range: string
        description: Link to the consent form. Leave empty if you want to use the default consent form.
        categories:
          - Privacy
        extensions:
          condition_language: json
          condition_body: '{"studyflow:requiresConsent": true}'
        comments:
          - Conditional on requiresConsent being true

  EndEvent:
    class_uri: bpmn:EndEvent
    annotations:
      icon: iconify bpmn--end-event
    attributes:
      hasRedirectUrl:
        range: boolean
        description: Redirect the user to the given URL after completion.
        categories:
          - Completion
      redirectUrl:
        range: string
        description: Link to redirect the user upon completion.
        categories:
          - Completion
        extensions:
          condition_language: json
          condition_body: '{"studyflow:hasRedirectUrl": true}'
        comments:
          - Conditional on hasRedirectUrl being true

  Activity:
    class_uri: bpmn:Activity
    description: Base class for all the activities in the Studyflow.
    abstract: true
    annotations:
      icon: iconify bpmn--task-none
    attributes:
      url:
        range: string
        description: Link to the activity.
        categories:
          - General
      isDataOperation:
        range: boolean
        ifabsent: "false"
        description: Toggle marker indicating the activity is a data operation.
        categories:
          - Data
      operation:
        range: DataOperationEnum
        description: Optional data operation marker for a data transformation task.
        categories:
          - Data
        extensions:
          condition_language: json
          condition_body: '{"studyflow:isDataOperation": true}'
        comments:
          - Conditional on isDataOperation being true
      operationSteps:
        range: MarkdownString
        multivalued: true
        description: Operator pipeline steps when operator is `compose`.
        categories:
          - Data
        extensions:
          condition_language: json
          condition_body: '{"studyflow:operation": "compose"}'
        comments:
          - Conditional on operator being "compose"

  CognitiveTask:
    is_a: bpmn:Task
    annotations:
      icon: iconify bi--puzzle
    attributes:
      instrument:
        range: InstrumentEnum
        description: Instrument used for the test.
        ifabsent: string(undefined)
        categories:
          - Instrument
      behaverseTask:
        range: BehaverseTaskEnum
        ifabsent: string(undefined)
        description: Behaverse instrument used for the test.
        categories:
          - Behaverse
        extensions:
          condition_language: json
          condition_body: '{"studyflow:instrument": "behaverse"}'
        comments:
          - Conditional on instrument being "behaverse"

  Questionnaire:
    is_a: bpmn:Task
    annotations:
      icon: iconify fluent--clipboard-text-edit-32-regular
    attributes:
      instrument:
        range: string
        description: |
          Instrument name used for the questionnaire. This can be an identifier for standardized questionnaires (e.g., PHQ-9, BDI-II, GAD-7) or a custom name for non-standardized questionnaires.
        categories:
          - Instrument

  Instruction:
    is_a: bpmn:Task
    description: A passive information display.
    annotations:
      icon: iconify material-symbols--info-outline-rounded
    attributes:
      content:
        range: MarkdownString
        description: Instruction content in markdown format.
        categories:
          - Content

  RandomGateway:
    is_a: bpmn:ExclusiveGateway
    annotations:
      icon: iconify streamline-flex--dice-5-remix
    attributes:
      algorithm:
        range: AssignmentAlgorithmEnum
        ifabsent: string(probabilistic)
        description: Algorithm used for the assignment.
        categories:
          - Assignment
      probabilityFunction:
        range: string
        ifabsent: string(uniform)
        description: Probability mass function that defines the discrete distribution of the random assignment. Defaults to `uniform`.
        categories:
          - Assignment
        extensions:
          condition_language: json
          condition_body: '{"studyflow:algorithm": "probabilistic"}'
        comments:
          - Conditional on algorithm being "probabilistic"

  Dataset:
    description: Base class for all datasets in the Studyflow.
    abstract: false
    is_a: bpmn:DataStoreReference
    annotations:
      icon: iconify bi--database
    attributes:
      catalog:
        range: DataCatalog
        description: Identifier of the `DataCatalog` that registers this dataset.
        categories:
          - Data
      store:
        range: DataStoreReference
        description: Identifier of the `DataStore` where this dataset is physically stored.
        categories:
          - Data
        extensions:
          condition_language: json
          condition_body: '{"studyflow:format": "bdm"}'
      schema:
        range: Schema
        description: |
          Path to the schema describing the dataset structure (e.g., CSVW).
          This can also refer to an optional ontology/vocabulary reference (URL/CURIE) for semantic alignment.
        categories:
          - Data

  DataStore:
    class_uri: bpmn:DataStoreReference
    description: |
      Persistent physical storage of data (database, filesystem, object store, etc.).
      BPMN `DataStore` can be referenced using `DataStoreReference`.
    abstract: false
    attributes:
      format:
        range: DatasetFormatEnum
        ifabsent: string(undefined)
        description: Format of the dataset (BDM, BIDS, Psych-DS, etc).
        categories:
          - Data
      bdmDataLevel:
        range: BDMDataLevelEnum
        ifabsent: string(events)
        description: Level of the data (events, trials, summary, models).
        categories:
          - Data
        extensions:
          condition_language: json
          condition_body: '{"studyflow:format": "bdm"}'
        comments:
          - Conditional on format being "bdm"
      bidsDataType:
        range: BIDSDataTypeEnum
        ifabsent: string(beh)
        description: BIDS data type (e.g., anat, func, eeg, beh).
        categories:
          - Data
        extensions:
          condition_language: json
          condition_body: '{"studyflow:format": "bids"}'
        comments:
          - Conditional on datasetFormat being "bids"

  DataObjectReference:
    class_uri: bpmn:DataObjectReference
    description: |
      Represents data produced/consumed within a process instance. Can be used to model
      internal data nodes in sub-processes and annotate state (e.g., raw/processed).
    abstract: true
    attributes:
      state:
        range: string
        description: Optional state annotation (e.g., raw, processed, validated).
        categories:
          - Data

  DataCatalog:
    description: A persistent repository/registry of datasets (e.g., openneuro, behaverse).
    abstract: true
    attributes:
      url:
        range: string
        description: Base URL of the catalog.
        categories:
          - Data

  Schema:
    description: |
      A formal description of the structure of a named collection of types.
      Typically used as column definitions for tables (CSVW), or dimensions/types for arrays.
    abstract: true
    attributes:
      url:
        range: string
        description: URL/path/identifier to the schema definition (e.g., CSVW JSON).
        categories:
          - Data
      format:
        range: string
        description: Schema format identifier (e.g., csvw, linkml, jsonschema).
        categories:
          - Data

  Table:
    description: |
      Named tabular structure within a dataset. Extends BPMN data objects and expects a schema.
    is_a: bpmn:DataObjectReference
    abstract: true
    annotations:
      icon: iconify bi--table
    attributes:
      dataset:
        range: string
        description: Identifier of the parent `Dataset`.
        categories:
          - Data
      schema:
        range: string
        description: URL/path/identifier of the table schema (typically CSVW).
        categories:
          - Data

  Array:
    description: |
      Multi-dimensional array/tensor structure (e.g., images, videos, fMRI). Expects a schema.
    abstract: true
    class_uri: bpmn:DataObjectReference
    attributes:
      dataset:
        range: string
        description: Identifier of the parent `Dataset`.
        categories:
          - Data
      schema:
        range: string
        description: URL/path/identifier of the array schema (dimensions/types/units).
        categories:
          - Data

  Snapshot:
    description: |
      Immutable version of a dataset/table/array associated with a point in the workflow
      or a version control commit.
    abstract: true
    attributes:
      source:
        range: string
        description: Identifier of the dataset/table/array being snapshotted.
        categories:
          - Data
      version:
        range: string
        description: Version identifier (e.g., tag, checksum, commit hash).
        categories:
          - Data